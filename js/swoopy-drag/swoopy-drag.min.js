d3.swoopyDrag=function(){function d(a,f){a.attr("transform",function(a){return"translate("+("function"==typeof f?f(a):f)+")"})}function g(a){return function(f){return f[a]}}var k=d3.scale.linear(),l=d3.scale.linear(),m=[],c,n=!1,e=d3.dispatch("drag"),p=d3.behavior.drag().on("drag",function(a){a.textOffset=[d3.event.x,d3.event.y].map(Math.round);d3.select(this).call(d,a.textOffset);e.drag()}).origin(function(a){return{x:a.textOffset[0],y:a.textOffset[1]}}),q=d3.behavior.drag().on("drag",function(a){a.pos=[d3.event.x,d3.event.y].map(Math.round);var f=d3.select(this.parentNode),b="";f.selectAll("circle").each(function(a){b=b+""+a.type+a.pos});f.select("path").attr("d",b).datum().path=b;d3.select(this).call(d,a.pos);e.drag()}).origin(function(a){return{x:a.pos[0],y:a.pos[1]}}),b=function(a){c=a.selectAll("g").data(m);c.exit().remove();c.enter().append("g");c.call(d,function(a){return[k(a),l(a)]});a=c.append("text").call(d,g("textOffset")).text(g("text"));c.append("path").attr("d",g("path"));n&&(c.style("cursor","pointer"),a.call(p),c.selectAll("circle").data(function(a){for(var b=[],c=1,d="M",g=0,h=1;h<a.path.length;h++){var e=a.path[h];","==e&&g++;if("L"==e||"C"==e||2==g)b.push({pos:a.path.slice(c,h).split(","),type:d}),d=e,c=h+1,g=0}b.push({pos:a.path.slice(c,h).split(","),type:d});return b}).enter().append("circle").attr({r:8,fill:"rgba(0,0,0,0)",stroke:"#333","stroke-dasharray":"2 2"}).call(d,g("pos")).call(q),e.drag())};b.annotations=function(a){if("undefined"==typeof a)return m;m=a;return b};b.x=function(a){if("undefined"==typeof a)return k;k=a;return b};b.y=function(a){if("undefined"==typeof a)return l;l=a;return b};b.draggable=function(a){if("undefined"==typeof a)return n;n=a;return b};return d3.rebind(b,e,"on")};